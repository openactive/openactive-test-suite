<head>
<style>
h3 {
    cursor: pointer;
    border-top-color: #CCC;
    border-top-width: 1px;
    border-top-style: solid;
    padding-top: 5px;
}
h3:hover {
    color: #0056b3; /* Example color change on hover */
}
</style>
</head>

<button id="collapseH3Button">Collapse All Sections</button>
<button id="showH3Button">Show All Sections</button>
<button id="showOnlyErrorsButton">Show All Errors</button>


# Summary of Test Suite Results for '{{ bookingServiceName }}'

Mode: **{{ useRandomOpportunitiesMode }}**

{{#if testResultSummary.numPassedTests}}✅ {{ testResultSummary.numPassedTests }} passing
{{/if}}{{#if testResultSummary.numFailedTests}}❌ {{ testResultSummary.numFailedTests }} failing
{{/if}}{{#if testResultSummary.numPendingTests}}– {{ testResultSummary.numPendingTests }} pending
{{/if}}

{{#if missingOpportunityDataSummary}}

## ❌ Missing Opportunity Data

Some of the tests failed because there were not enough opportunities in the booking system under test that matched the required [criteria](https://github.com/openactive/openactive-test-suite/blob/master/packages/openactive-integration-tests/test/features/README.md).

This only happens when using [Random Mode](https://developer.openactive.io/open-booking-api/test-suite#random-mode) as opposed to [Controlled Mode](https://developer.openactive.io/open-booking-api/test-suite#controlled-mode).

In order to pass these tests, please increase the number of opportunities in the Booking System. Make sure that there are many opportunities available that match each criteria.

You can use [test-data-generator](https://github.com/openactive/openactive-test-suite/tree/master/packages/openactive-integration-tests/test-data-generator) to get a specification of how much of each type of opportunity you need to generate.

If any of these criteria are not relevant to your Booking System, you may need to remove the relevant feature from your Test Suite configuration (See [`implementedFeatures`](https://github.com/openactive/openactive-test-suite/tree/master/packages/openactive-integration-tests#implementedfeatures)).

### Results

This is a list of the criteria, opportunity type, etc for which no opportunities
were found, that also includes a list of which tests failed as a result:

{{!-- This is rendered to HTML as the markdown->HTML renderer was creating <p>s
  for each root list item, which resulted in overlarge margins --}}
<ul>
  {{#each missingOpportunityDataSummary}}

  <li>
    ❌️ Missing Criteria: <strong><a href="https://openactive.io/test-interface#{{@key}}">{{@key}}</a></strong>
    <ul>
      <li><a href="https://developer.openactive.io/publishing-data/data-feeds/types-of-feed#event-relationship-overview">Opportunity Types</a>: {{#each (lookup . "opportunityTypes")}}<strong>{{.}}</strong>{{#unless @last}}, {{/unless}}{{/each}}</li>
      <li><a href="https://openactive.io/open-booking-api/EditorsDraft/1.0CR3/#booking-flows">Booking Flows</a>: {{#each (lookup . "bookingFlows")}}<strong>{{.}}</strong>{{#unless @last}}, {{/unless}}{{/each}}</li>
      <li>Sellers: {{#each (lookup . "sellerIds")}}<code>{{.}}</code>{{#unless @last}}, {{/unless}}{{/each}}</li>
      <li>Tests failing as a result: {{lookup . "numTestsFailing"}}</li>
    </ul>
  </li>

  {{/each}}
</ul>

{{/if}}

## Tests

{{#eachSorted opportunityTypeGroups }}

<h3> {{{ opportunityTypeName }}} </h3>

<ul>
  {{#each featureGroups }}
  <li> {{{ validationIcon overallStatus }}} {{{ featureName }}} ({{implementedDisplayLabel}})
    <ul>
      {{#each loggers}}
      <li> {{{ validationIcon overallStatus }}} [{{{ suiteName }}}]({{{ htmlLocalPath }}}): ({{{ numFailed }}} failures, {{{ numWarnings }}} warnings, {{{ numSuggestions }}} suggestions, {{{ numPassed }}} passes)</li>
      {{/each}}
    </ul>
  </li>
  {{/each}}
</ul>

{{/eachSorted}}

---

<script>
  function collapseH3Section(nextElement) {
    while (nextElement && nextElement.tagName !== 'H3') {
      if (nextElement.style.display !== 'none') {
        nextElement.style.display = 'none';
      }
      nextElement = nextElement.nextElementSibling;
    }
  }

  function showH3Section(nextElement) {
    while (nextElement && nextElement.tagName !== 'H3') {
      // Explicitly set display to '' to revert to default
      nextElement.style.display = ''; 
      nextElement = nextElement.nextElementSibling;
    }
  }

  function toggleH3Section(nextElement) {
    while (nextElement && nextElement.tagName !== 'H3') {
      // Toggle visibility
      nextElement.style.display = nextElement.style.display === 'none' ? '' : 'none';
      nextElement = nextElement.nextElementSibling;
    }
  }

  function collapseAllH3Sections() {
    var H3Elements = document.querySelectorAll('H3');
    H3Elements.forEach(function (H3) {
      var nextElement = H3.nextElementSibling;
      collapseH3Section(nextElement);
    });
  }

  function showH3Sections(mode) {
    var H3Elements = document.querySelectorAll('H3');
    H3Elements.forEach(function (H3) {
      var nextElement = H3.nextElementSibling;

      // Always show the H3 section
      showH3Section(H3);
      showH3Section(nextElement);

      // Iterate through each li element
      var liElements = nextElement.querySelectorAll('li');
      liElements.forEach(function (li) {
        if (mode === 'all' || (mode === 'error' && li.innerHTML.includes('❌'))) {
          showH3Section(li); // Show the li element if mode is 'all' or it contains an error and mode is 'error'
        } else {
          collapseH3Section(li); // Collapse the li element
        }
      });
    });
  }
  
  // Show/Hide each header section  - toggle
  document.querySelectorAll('H3').forEach(function (H3) {
    H3.addEventListener('click', function () {
      let nextElement = this.nextElementSibling;
      toggleH3Section(nextElement)
    });
  });

  // Collapse all header sections button
  document.getElementById('collapseH3Button').addEventListener('click', function () {
    collapseAllH3Sections();
  });

  // Update button event listeners to use the new function
  document.getElementById('showH3Button').addEventListener('click', function () {
    showH3Sections('all'); // Show all sections
  });

  document.getElementById('showOnlyErrorsButton').addEventListener('click', function () {
    showH3Sections('error'); // Show only errors
  });

  // Show only errors by default
  showH3Sections('error'); 
</script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script>hljs.highlightAll();</script>
